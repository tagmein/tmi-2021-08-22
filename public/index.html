<head>
  <meta charset="utf-8" />
</head>
<body>
  <style>
    html,
    body {
      height: 100vh;
      min-height: 100%;
      overflow: hidden;
      margin: 0;
    }
    body,
    body > div,
    body > textarea,
    body > div * {
      display: flex;
      box-sizing: border-box;
      font-size: 14px;
      font-family: "IBM Plex Mono", sans-serif;
      background-color: #009;
      color: #fc8;
      flex-shrink: 1;
      flex-grow: 1;
      font-weight: 400;
      resize: none;
    }
    body {
      flex-direction: row;
      overflow-x: auto;
      padding: 2px;
    }
    input:focus,
    textarea:focus {
      box-shadow: 0 0 1px 1px white;
      outline: none;
    }
    .list {
      margin: 2px;
      min-width: 100px;
      max-width: 250px;
      flex-direction: column;
    }
    .term {
      max-height: 28px;
      padding: 4px 4px 6px;
      border: 2px solid #00f;
      margin-bottom: 4px;
    }
    .payload {
      padding: 2px 4px 6px;
      margin: 2px;
      min-width: 250px;
      flex-grow: 1;
      border: 2px solid #00f;
      background-color: #003;
      color: yellow;
    }
    .fullscreen {
      border-top-left-radius: 4px;
      padding: 2px 4px;
      position: absolute;
      right: 4px;
      bottom: 4px;
      cursor: default;
    }
    .fullscreen:hover {
      background-color: #44a;
    }
    .fullscreen:active {
      background-color: #447;
    }
    .footer {
      max-width: 60vw;
      position: absolute;
      bottom: 4px;
      left: 4px;
      transform-origin: bottom left;
      transform: scale(0.75);
      opacity: 0.5;
      transition: 0.3s ease opacity, 0.3s ease transform;
      cursor: no-drop;
    }
    .footer:hover {
      opacity: 1;
      transform: scale(1);
    }
  </style>
  <script>
    function el(appendTo, cls, tagName = "div") {
      const e = document.createElement(tagName);
      e.classList.add(cls);
      appendTo.appendChild(e);
      return e;
    }
    const footer = el(document.body, "footer");
    footer.appendChild(
      document.createTextNode(
        'tagme.in • Public Domain • Enter "src" to view the source of index.html, or right click and select "View Page Source" or "View Source" in your browser. Click to dismiss.'
      )
    );
    footer.addEventListener("click", () => {
      footer.parentElement.removeChild(footer);
    });
    const fs = el(document.body, "fullscreen");
    fs.appendChild(document.createTextNode("Fullscreen"));
    fs.addEventListener("click", () => {
      if (
        document.fullscreenElement ||
        document.webkitFullscreenElement ||
        document.mozFullScreenElement
      ) {
        document.exitFullscreen();
      } else {
        document.body.requestFullscreen();
      }
    });
    function list(appendTo) {
      let activeLevel = 0;
      const listAddress = [];
      const listElem = el(appendTo, "list");
      const payloadElem = el(appendTo, "payload", "textarea");
      function legacyKey() {
        return JSON.stringify(listAddress.filter((x) => x !== ""));
      }
      function key() {
        return listAddress
          .filter((x) => x !== "")
          .map((x) => x.trim())
          .join(" ");
      }
      payloadElem.addEventListener("keyup", () => {
        const k = key();
        if (k === "::::") {
          newItems = Object.entries(JSON.parse(payloadElem.value));
          for (const [iK, iV] of newItems) {
            localStorage.setItem(iK, iV);
          }
          alert(`Learned ${newItems.length} items`);
        } else {
          localStorage.setItem(k, payloadElem.value);
        }
      });
      payloadElem.addEventListener("keydown", (event) => {
        switch (event.key) {
          case "Tab":
            event.preventDefault();
            listElem.firstElementChild.focus();
            listElem.firstElementChild.select();
            break;
        }
      });
      function reloadListContents() {
        const k = key();
        if (k === "::::") {
          payloadElem.value = JSON.stringify({ ...localStorage });
          return;
        }
        const oldContents = localStorage.getItem(legacyKey());
        const contents = localStorage.getItem(k);
        if (oldContents && !contents) {
          localStorage.setItem(k, oldContents);
        }
        payloadElem.value = contents ?? oldContents ?? "";
      }
      const listTools = {
        dig(initialValue) {
          const termIndex = listElem.childElementCount;
          const termElem = el(listElem, "term", "input");
          termElem.value = initialValue;
          listAddress[termIndex] = initialValue;
          reloadListContents();
          termElem.addEventListener("keyup", () => {
            listAddress[termIndex] = termElem.value;
            reloadListContents();
          });
          termElem.addEventListener("keydown", (event) => {
            switch (event.key) {
              case " ":
                event.preventDefault();
                const spaceIndex = termElem.value.indexOf(" ");
                listOne.dig(
                  spaceIndex !== -1 ? termElem.value.splice(spaceIndex) : ""
                );
                if (spaceIndex !== -1) {
                  termElem.value = termElem.value.slice(0, spaceIndex);
                }
                break;
              case "ArrowUp":
                termElem.previousElementSibling?.focus();
                break;
              case "ArrowDown":
                termElem.nextElementSibling?.focus();
                break;
              case "Backspace":
                if (termElem.value === "" && listElem.childElementCount > 1) {
                  const sib =
                    termElem.nextElementSibling ??
                    termElem.previousElementSibling;
                  termElem.parentElement.removeChild(termElem);
                  listAddress.splice(termIndex, 1);
                  reloadListContents();
                  event.preventDefault();
                  if (sib) {
                    sib.focus();
                  }
                }
                break;
              case "Enter":
                const newTerm = listTools.dig("");
                reloadListContents();
                newTerm.focus();
                break;
            }
          });
          activeLevel++;
          termElem.focus();
          return termElem;
        },
      };
      return listTools;
    }
    const listOne = list(document.body);
    listOne.dig("paper");
  </script>
</body>

<script>
  localStorage.setItem(
    "src",
    `<head>
  <meta charset="utf-8" />
</head>
<body>
  <style>
    html,
    body {
      height: 100vh;
      min-height: 100%;
      overflow: hidden;
      margin: 0;
    }
    body,
    body > div,
    body > textarea,
    body > div * {
      display: flex;
      box-sizing: border-box;
      font-size: 14px;
      font-family: "IBM Plex Mono", sans-serif;
      background-color: #009;
      color: #fc8;
      flex-shrink: 1;
      flex-grow: 1;
      font-weight: 400;
      resize: none;
    }
    body {
      flex-direction: row;
      overflow-x: auto;
      padding: 2px;
    }
    input:focus,
    textarea:focus {
      box-shadow: 0 0 1px 1px white;
      outline: none;
    }
    .list {
      margin: 2px;
      min-width: 100px;
      max-width: 250px;
      flex-direction: column;
    }
    .term {
      max-height: 28px;
      padding: 4px 4px 6px;
      border: 2px solid #00f;
      margin-bottom: 4px;
    }
    .payload {
      padding: 2px 4px 6px;
      margin: 2px;
      min-width: 250px;
      flex-grow: 1;
      border: 2px solid #00f;
      background-color: #003;
      color: yellow;
    }
    .fullscreen {
      border-top-left-radius: 4px;
      padding: 2px 4px;
      position: absolute;
      right: 4px;
      bottom: 4px;
      cursor: default;
    }
    .fullscreen:hover {
      background-color: #44a;
    }
    .fullscreen:active {
      background-color: #447;
    }
    .footer {
      max-width: 60vw;
      position: absolute;
      bottom: 4px;
      left: 4px;
      transform-origin: bottom left;
      transform: scale(0.75);
      opacity: 0.5;
      transition: 0.3s ease opacity, 0.3s ease transform;
      cursor: no-drop;
    }
    .footer:hover {
      opacity: 1;
      transform: scale(1);
    }
  </style>
  <script>
    function el(appendTo, cls, tagName = "div") {
      const e = document.createElement(tagName);
      e.classList.add(cls);
      appendTo.appendChild(e);
      return e;
    }
    const footer = el(document.body, "footer");
    footer.appendChild(
      document.createTextNode(
        'tagme.in • Public Domain • Enter "src" to view the source of index.html, or right click and select "View Page Source" or "View Source" in your browser. Click to dismiss.'
      )
    );
    footer.addEventListener("click", () => {
      footer.parentElement.removeChild(footer);
    });
    const fs = el(document.body, "fullscreen");
    fs.appendChild(document.createTextNode("Fullscreen"));
    fs.addEventListener("click", () => {
      if (
        document.fullscreenElement ||
        document.webkitFullscreenElement ||
        document.mozFullScreenElement
      ) {
        document.exitFullscreen();
      } else {
        document.body.requestFullscreen();
      }
    });
    function list(appendTo) {
      let activeLevel = 0;
      const listAddress = [];
      const listElem = el(appendTo, "list");
      const payloadElem = el(appendTo, "payload", "textarea");
      function legacyKey() {
        return JSON.stringify(listAddress.filter((x) => x !== ""));
      }
      function key() {
        return listAddress
          .filter((x) => x !== "")
          .map((x) => x.trim())
          .join(" ");
      }
      payloadElem.addEventListener("keyup", () => {
        const k = key();
        if (k === "::::") {
          newItems = Object.entries(JSON.parse(payloadElem.value));
          for (const [iK, iV] of newItems) {
            localStorage.setItem(iK, iV);
          }
          alert(`Learned ${newItems.length} items`);
        } else {
          localStorage.setItem(k, payloadElem.value);
        }
      });
      payloadElem.addEventListener("keydown", (event) => {
        switch (event.key) {
          case "Tab":
            event.preventDefault();
            listElem.firstElementChild.focus();
            listElem.firstElementChild.select();
            break;
        }
      });
      function reloadListContents() {
        const k = key();
        if (k === "::::") {
          payloadElem.value = JSON.stringify({ ...localStorage });
          return;
        }
        const oldContents = localStorage.getItem(legacyKey());
        const contents = localStorage.getItem(k);
        if (oldContents && !contents) {
          localStorage.setItem(k, oldContents);
        }
        payloadElem.value = contents ?? oldContents ?? "";
      }
      const listTools = {
        dig(initialValue) {
          const termIndex = listElem.childElementCount;
          const termElem = el(listElem, "term", "input");
          termElem.value = initialValue;
          listAddress[termIndex] = initialValue;
          reloadListContents();
          termElem.addEventListener("keyup", () => {
            listAddress[termIndex] = termElem.value;
            reloadListContents();
          });
          termElem.addEventListener("keydown", (event) => {
            switch (event.key) {
              case " ":
                event.preventDefault();
                const spaceIndex = termElem.value.indexOf(" ");
                listOne.dig(
                  spaceIndex !== -1 ? termElem.value.splice(spaceIndex) : ""
                );
                if (spaceIndex !== -1) {
                  termElem.value = termElem.value.slice(0, spaceIndex);
                }
                break;
              case "ArrowUp":
                termElem.previousElementSibling?.focus();
                break;
              case "ArrowDown":
                termElem.nextElementSibling?.focus();
                break;
              case "Backspace":
                if (termElem.value === "" && listElem.childElementCount > 1) {
                  const sib =
                    termElem.nextElementSibling ??
                    termElem.previousElementSibling;
                  termElem.parentElement.removeChild(termElem);
                  listAddress.splice(termIndex, 1);
                  reloadListContents();
                  event.preventDefault();
                  if (sib) {
                    sib.focus();
                  }
                }
                break;
              case "Enter":
                const newTerm = listTools.dig("");
                reloadListContents();
                newTerm.focus();
                break;
            }
          });
          activeLevel++;
          termElem.focus();
          return termElem;
        },
      };
      return listTools;
    }
    const listOne = list(document.body);
    listOne.dig("paper");
  <\/script> <!-- how to escape this: <\\/script> -->
</body>`
  );
</script>
