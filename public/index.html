<!doctype html>

<head>
 <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0" />
 <meta charset="UTF-8">
 <title>Tag Me In</title>
 <style>
  @font-face {
   font-family: "DejaVu Sans Mono";
   font-style: normal;
   font-weight: normal;
   src: local(DejaVu Sans Mono), local(DejaVuSansMono),
    url(./rsrc/font/DejaVuSansMono.woff) format("woff");
  }

  @font-face {
   font-family: "DejaVu Sans Mono";
   font-style: normal;
   font-weight: bold;
   src: local(DejaVu Sans Mono Bold), local(DejaVuSansMono-Bold),
    url(./rsrc/font/DejaVuSansMono-Bold.woff) format("woff");
  }

  @font-face {
   font-family: "DejaVu Sans Mono";
   font-style: oblique;
   font-weight: bold;
   src: local(DejaVu Sans Mono Bold Oblique), local(DejaVuSansMono-BoldOblique),
    url(./rsrc/font/DejaVuSansMono-BoldOblique.woff) format("woff");
  }

  @font-face {
   font-family: "DejaVu Sans Mono";
   font-style: oblique;
   font-weight: normal;
   src: local(DejaVu Sans Mono Oblique), local(DejaVuSansMono-Oblique),
    url(./rsrc/font/DejaVuSansMono-Oblique.woff) format("woff");
  }

  body {
   height: 100vh;
   background-color: #113;
   color: #bba;
   flex-direction: row;
  }

  body,
  button,
  select,
  textarea,
  input,
  option {
   font-family: 'DejaVu Sans Mono';
   font-size: 16px;
  }

  body,
  section {
   display: flex;
   overflow: hidden;
   border-left: 1px solid #887;
   border-right: 1px solid #887;
  }

  section {
   flex-direction: column;
   flex-grow: 0;
   flex-shrink: 0;
   width: 50vw;
  }

  @media screen and (max-width: 1080px) {
   body {
    overflow-x: scroll;
   }

   section {
    width: 100vw;
   }
  }
 </style>
 <style>
  * {
   box-sizing: border-box;
   font-weight: 500;
   margin: 0;
   padding: 0;
   text-shadow: 0 0 0.5px #bba, 0 0 0.5px #bba;
  }

  *::selection {
   color: #fff;
   background-color: #887;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
   padding: 36px 16px;
   border-bottom: 2px solid #887;
   margin: 0;
   position: relative;
   display: flex;
   flex-direction: column;
  }

  main {
   margin: 0;
   padding: 0 16px;
   opacity: 0.5;
   transition: opacity 0.15s ease;
   position: absolute;
   bottom: 0;
   left: 0;
   max-width: 100vw;
   overflow-y: hidden;
   overflow-x: auto;
   white-space: pre;
   display: flex;
   flex-direction: row;
  }

  main:hover {
   opacity: 1;
  }

  button {
   color: #fff;
   border: none;
   margin: 0;
   padding: 8px;
   text-transform: uppercase;
   transition: color 0.15s ease, background-color 0.15s ease;
   letter-spacing: 0.5px;
   font-weight: bold;
   background-color: transparent;
   font-size: 14px;
   flex-shrink: 1;
   flex-grow: 0;
   cursor: pointer;
  }

  button:hover {
   color: #000;
   background-color: #887;
  }

  button:active {
   color: #000;
   background-color: #665;
  }

  .address,
  .info {
   position: absolute;
   top: 0;
   padding: 8px 16px;
   font-size: 16px;
   color: #bba;
   background-color: transparent;
   width: 50%;
   overflow: hidden;
   border: none;
  }

  .address {
   left: 0;
  }

  .info {
   right: 0;
   font-size: 10px;
   line-height: 24px;
   text-align: right;
  }

  *:focus {
   outline: none;
   box-shadow: inset 0 0 0 2px #bba;
  }

  span {
   display: inline-block;
   height: 1.25em;
   overflow: visible;
   text-overflow: ellipsis;
   white-space: nowrap;
  }

  span::after {
   content: '.';
   display: inline;
   user-select: none;
   color: transparent;
   text-shadow: none;
  }

  .dialog {
   position: fixed;
   top: 0;
   left: 0;
   height: 100vh;
   width: 100vw;
   display: none;
   /* flex */
   flex-direction: column;
   background-color: #888888;
  }

  .dialog button {
   width: 100%;
   height: 50%;
   font-size: 200%;
   opacity: 0.7;
  }

  .dialog button:first-of-type {
   background-color: #533;
   color: #f66;
  }

  .dialog button:last-of-type {
   background-color: #353;
   color: #6f6;
  }

  .dialog button:first-of-type:hover {
   opacity: 1;
  }

  .dialog button:last-of-type:hover {
   opacity: 1;
  }

  .dialog article {
   background-color: #553;
   display: flex;
   overflow: visible;
   align-items: center;
   justify-content: center;
   flex-direction: column;
   z-index: 1;
   padding: 2vh;
  }

  .dialog blockquote {
   margin: 0 2vh;
   text-align: center;
   background-color: #c8c8c8;
   color: #444444;
   border-radius: 2vh;
   padding: 2vh;
  }

  .dialog input {
   width: calc(100vw - 8vh);
   margin: 2vh auto 0;
   line-height: 200%;
   font-size: inherit;
   background-color: transparent;
   color: #c8c8c8;
   font-family: inherit;
   border: 2px solid #c9c9c9;
   padding: 2vh;
   border-radius: 2vh;
  }

  *:focus {
   outline: none;
   box-shadow: inset 0 0 0 2px #c9c9c9;
  }

  aside {
   height: 0;
   overflow: hidden;
   background-color: #c8c8c838;
   margin: 0.175em 0 -0.175em;
   transition: height 0.5s linear;
  }
 </style>
</head>

<body>
 <section>
  <h1 id="first"></h1>
 </section>
 <section>
  <h1></h1>
 </section>
 <main id="toolbar">
  <button>Open</button>
  <button>Close</button>
  <button>Edit</button>
  <button>Erase</button>
  <button>Move</button>
  <button>Run</button>
  <!--button>Pick</button>
  <button>Drop</button-->
 </main>
 <div class="dialog" id="dialog-wrap">
  <button id="dialog-no">No</button>
  <article>
   <blockquote id="dialog-question">Would you like to continue?</blockquote>
   <input id="dialog-response" />
  </article>
  <button id="dialog-yes">Yes</button>
 </div>
 <script>
  function zygote(config) {
   const me = { config }
   return me
  }
 </script>
 <script>
  function getByIds(prefix, ...ids) {
   const result = {}
   for (const id of ids) {
    result[id] = document.getElementById(`${prefix}${id}`)
   }
   return result
  }
  let onNo, onYes
  const dialogElements = getByIds('dialog-', 'wrap', 'no', 'yes', 'question', 'response')
  function closeDialog() {
   dialogElements.wrap.style.display = 'none'
  }
  dialogElements.no.addEventListener('click', async () => {
   await new Promise(r => setTimeout(r, 150))
   onNo?.()
   closeDialog()
  })
  dialogElements.yes.addEventListener('click', async () => {
   await new Promise(r => setTimeout(r, 150))
   onYes?.()
   closeDialog()
  })

  async function dialog(question, hasInput = false, no = 'NO', yes = 'YES', previously) {
   dialogElements.wrap.style.display = 'flex'
   dialogElements.question.innerText = question
   dialogElements.no.innerText = no
   dialogElements.yes.innerText = yes
   dialogElements.response.style.display = hasInput ? 'inline-block' : 'none'
   dialogElements.response.value = typeof previously === 'string' ? previously : ''
   return new Promise(r => {
    onNo = r.bind(undefined, false)
    onYes = () => r(hasInput ? dialogElements.response.value : true)
   })
  }
  const COMMAND = {
   async CLOSE(h) {
    const section = h.container.parentElement
    h.close()
    if (section.childElementCount === 0) {
     await new Promise(r => setTimeout(r, 500))
     section.appendChild((await cell(document.createElement('h1'))).container)
    }
   },
   async EDIT(h) {
    const previously = localStorage.getItem(h.address.value)
    const answer = await dialog(`Make changes to '${h.address.value}'`, true, 'Cancel', 'Save', previously)
    if (answer !== false) {
     localStorage.setItem(h.address.value, answer)
     await h.openAddress()
     // alert(`Saved '${h.address.value}', was previously: ${previously}`)
    }
   },
   async ERASE(h) {
    const answer = await dialog(`Are you sure you want to erase '${h.address.value}'?`, false, 'Cancel', 'Erase')
    if (answer) {
     const previously = localStorage.getItem(h.address.value)
     localStorage.removeItem(h.address.value)
     // alert(`Erased '${h.address.value}', was previously: ${previously}`)
     COMMAND.CLOSE(h)
    }
   },
   async MOVE(h) {
    const answer = await dialog(`Enter address to move '${h.address.value}' to`, true, 'Cancel', 'Save')
    console.log({ answer, message: 'not implemented' })
   },
   async OPEN(h) {
    h.toggleOpen()
   }
  }
 </script>
 <script>
  async function delay(t = 150) {
   await new Promise(r => setTimeout(r, t))
  }
  async function cell(container) {
   const address = document.createElement('input')
   address.classList.add('address')
   address.setAttribute('placeholder', 'home')
   container.appendChild(address)
   const info = document.createElement('input')
   info.classList.add('info')
   info.setAttribute('readonly', 'readonly')
   const content = document.createElement('span')
   container.appendChild(content)
   container.appendChild(info)
   const openPanel = document.createElement('aside')
   container.appendChild(openPanel)
   async function openAddress() {
    info.value = (new Date).toISOString()
    Object.assign(container.style, {
     backgroundColor: '#887',
     transition: 'background-color 0.15s linear'
    })
    await delay()
    content.innerText = localStorage.getItem(address.value) ?? 'Tag Me In'
    container.style.backgroundColor = 'transparent'
   }
   function debounce(fn, time = 500) {
    let timer
    return function () {
     clearTimeout(timer)
     timer = setTimeout(fn, time)
    }
   }
   openAddressDebounced = debounce(openAddress)
   address.addEventListener('keyup', openAddressDebounced)
   address.addEventListener('change', openAddressDebounced)
   openAddress()
   function close() {
    container.parentElement.removeChild(container)
   }
   let openPanelIsOpen = false
   function toggleOpen() {
    openPanelIsOpen = !openPanelIsOpen
    openPanel.style.height = openPanelIsOpen ? '20em' : '0'
   }
   const me = { address, container, close, info, openAddress, toggleOpen }
   container.cell = me
   return me
  }
  const toolbarContainer = document.getElementById('toolbar')
  toolbarContainer.addEventListener('click', e => {
   const command = e.target.innerText
   if (command in COMMAND) {
    COMMAND[command](toolbarContainer.parentElement.cell)
   }
  })
  function toolbar(element) {
   element.appendChild(toolbarContainer)
  }
  toolbar(document.getElementById('first'))
  Array.from(document.getElementsByTagName('h1'))
   .map(cell)
  document.body.addEventListener('mouseover', e => {
   if (e.target.tagName.startsWith('H')) {
    toolbar(e.target)
   }
  })
 </script>
</body>